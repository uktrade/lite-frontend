{% extends 'layouts/base.html' %}

{% block back_link %}{% endblock %}

{% block title %}
    Search - Products
{% endblock %}

{% block body %}
    <div class="lite-app-bar govuk-!-margin-bottom-0">
        <div class="lite-app-bar__content">
            <h1 class="govuk-heading-l">Search products</h1>
        </div>
    </div>
    <section class="search-results govuk-!-margin-top-4">
        <h1 class="govuk-body">{{ search_results.count }} products found</h1>
        {% for good in search_results.results %}
            <article class="search-result">
                <header class="search-result__header">
                    <div class="search-result__header-wrapper">
                        <h1 class="search-result__product-name govuk-heading-m">{{ good.name }}</h1>
                        <div class="search-result__company-name">{{ good.organisation }}</div>
                    </div>
                    {% if good.part_number %}
                        <div class="search-result__part-number">{{ good.part_number }}</div>
                    {% endif %}
                </header>
                <table class="govuk-table">
                    <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th scope="col" class="govuk-table__header">
                                Case reference
                            </th>
                            <th scope="col" class="govuk-table__header">
                                Destination
                            </th>
                            <th scope="col" class="govuk-table__header">
                                Control entry
                            </th>
                            <th scope="col" class="govuk-table__header">
                                Report summary
                            </th>
                            <th scope="col" class="govuk-table__header">
                                Assessment notes
                            </th>
                        </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                        {% for good_on_application in good.inner_hits.hits %}
                            <tr class="govuk-table__row">
                                <th scope="row" class="govuk-table__cell govuk-body">{{ good_on_application.application.reference_code }}</th>
                                <td class="govuk-table__cell">{{ good_on_application.destination }}</td>
                                <td class="govuk-table__cell">{% for cle in good_on_application.control_list_entries %}{{ cle.rating }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
                                <td class="govuk-table__cell">{{ good_on_application.report_summary|default:"" }}</td>
                                <td class="govuk-table__cell">{{ good_on_application.rating_comment|default:"" }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </article>
        {% endfor %}
    </section>
{% endblock %}
