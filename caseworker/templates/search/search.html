{% extends 'layouts/base.html' %}

{% load parse_date from spire_tags %}

{% block back_link %}{% endblock %}

{% block title %}Search Cases{% endblock %}

{% block body %}
<div class="lite-app-bar govuk-!-margin-bottom-0">
	<div class="lite-app-bar__content">
		<h1 class="govuk-heading-l">Search Cases</h1>
	</div>
</div>
<form method="get">
	<div class="lite-filter-bar govuk-!-margin-top-0">
		<div class="lite-filter-bar__components">
			{{ form.as_p }}
		</div>
		<div class="lite-filter-bar__buttons">
			<button type="submit" class="govuk-button">Search</button>
			<a href="?" class="govuk-button govuk-button--secondary govuk-button--secondary-white"
				id="button-clear-filters">
				Clear
			</a>
		</div>
	</div>
	<p id="text-case-count" class="lite-filters__hint-text">{{ results.count }} items found</p>
	{% if results.count %}

	<table class="govuk-table">
		<thead class="govuk-table__head">
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="col">Case</th>
				<th class="govuk-table__header" scope="col">Goods Info</th>
				<th class="govuk-table__header" scope="col">Controlled status</th>
				<th class="govuk-table__header" scope="col">ARS</th>
				<th class="govuk-table__header" scope="col">Comment</th>
			</tr>
		</thead>
		<tbody class="govuk-table__body">
			{% for item in results.results %}
			<tr class="govuk-table__row">
				<td class="govuk-table__cell govuk-table__cell--tight">
					<a class="govuk-link govuk-link--no-visited-state" id="case-${item.application.id}"
						href="/cases/${item.application.id}/">
						<span class="govuk-visually-hidden">View</span> {{ item.application.reference_code }}
					</a>
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">
						{{ item.application.organisation }}
					</p>
					<p class="govuk-tag govuk-tag--grey govuk-!-margin-0 govuk-!-margin-top-2">
						{{ item.application.status }}</p>
				</td>
				<td class="govuk-table__cell govuk-table__cell--tight">
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">Part number:
						{{ item.good.part_number }}</p>
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">Description:
						{{ item.good.description }}</p>
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">Quantity: {{ item.quantity }}</p>
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">Value: {{ item.value }}</p>
				</td>
				<td class="govuk-table__cell govuk-table__cell--tight">
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">Controlled:
						{{ item.good.is_good_controlled }}</p>
					{% if item.good.clc_entries %}
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">
						CLC entries:
						{% for entry in item.good.clc_entries %}
						<span class="govuk-hint lite-!-display-inline">{{ entry.rating }}</span>
						{% if not forloop.last %}
						,
						{% endif %}
						{% endfor %}
					</p>
					{% endif %}
				</td>
				<td class="govuk-table__cell govuk-table__cell--tight">
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">{{ item.good.report_summary }}
					</p>
				</td>
				<td class="govuk-table__cell govuk-table__cell--tight">
					<p class="govuk-body govuk-!-margin-top-2 govuk-!-margin-bottom-0">{{ item.good.comment }}
					</p>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% pagination %}
	{% endif %}
</form>
{% endblock %}
