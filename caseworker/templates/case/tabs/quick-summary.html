{% load static advice_tags %}
{% load humanize %}

<h2 class="govuk-heading-m">Quick Summary</h2>

<table class="govuk-table app-table">
    <tbody class="govuk-table__body" id="tbody-placeholder">
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Status</th>
            <td class="govuk-table__cell">{{ case.data.status.value }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Licensing unit case officer</th>
            <td class="govuk-table__cell">
				{% if case.case_officer %}
					{{ case.case_officer|username }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						Not assigned
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Case advisers</th>
            <td class="govuk-table__cell">
			{% if case.assigned_users %}
				{{ case|get_adviser_list|join:", " }}
			{% else %}
				<span class="govuk-hint govuk-!-margin-0">
					Not assigned
				</span>
			{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Temporary or permanent</th>
            <td class="govuk-table__cell">{{ case.data.export_type.key }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Assigned queues</th>
            <td class="govuk-table__cell">
				{% if case.queue_details %}
					{{ case.queue_details|get_values_from_dict_list:"name"|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						Not assigned
					</span>
				{% endif %}

            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Flags</th>
            <td class="govuk-table__cell">
				{% if case.flags or case.destinations_flags or case.goods_flags %}
					{{ case.all_flags|get_flags_list|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Open query</th>
            <td class="govuk-table__cell">
				{% if case.has_open_queries %}
					Outstanding queries
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Latest action</th>
            <td class="govuk-table__cell">
				{% if case.latest_activity %}
					<div>
						{% if case.latest_activity.user.type == 'exporter' %}
							Applicant {{ case.latest_activity.created_at|to_datetime|date:"d F Y" }}
						{% else %}
							{{ case.latest_activity.user.team }} {{ case.latest_activity.created_at|to_datetime|date:"d F Y" }}
						{% endif %}
					</div>
					<div>
						{{ case.latest_activity.user.first_name }} {{ case.latest_activity.user.last_name }} {{ case.latest_activity.text|linebreaksbr }}
					</div>
					{% if case.latest_activity.additional_text %}
						<div class="app-updates__activity">
							{{ case.latest_activity.additional_text|linebreaksbr }}
						</div>
					{% endif %}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Days on queue elapsed</th>
            <td class="govuk-table__cell">
				{% if case.queue_details %}
                    {% for queue_detail in case.queue_details %}
                        {% if queue_detail.id == queue.id %}
                            {{queue_detail.days_on_queue_elapsed}}
                        {% endif %}
                    {% endfor %}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						N/A
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Total days elapsed</th>
            <td class="govuk-table__cell">
				{% if not is_terminal %}
					{{ case.total_days_elapsed }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						N/A
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Product names</th>
            <td class="govuk-table__cell">
                {% for name in goods_summary.names %}
                    {{name}}<br/>
                {% endfor %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Total value</th>
            <td class="govuk-table__cell">Â£{{ goods_summary.total_value|floatformat:2|intcomma }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Control list entries</th>
            <td class="govuk-table__cell">
				{% if goods_summary.cles %}
                    {% for cle in goods_summary.cles %}
                        {{cle}}<br/>
                    {% endfor %}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Regimes</th>
            <td class="govuk-table__cell">
				{% if goods_summary.regimes %}
					{{ goods_summary.regimes|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Report summaries</th>
            <td class="govuk-table__cell">
				{% if goods_summary.report_summaries %}
					{{ goods_summary.report_summaries|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Security graded</th>
            <td class="govuk-table__cell">{{ case.goods|is_case_pv_graded|yesno|capfirst }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Security approvals</th>
            <td class="govuk-table__cell">
				{% if case.data.security_approvals %}
					{{ case.data.security_approvals|list_to_choice_labels:security_classified_approvals_types }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Applicant name</th>
            <td class="govuk-table__cell">{{ case.data.submitted_by }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Destinations</th>
            <td class="govuk-table__cell">{{ destination_countries|join:", " }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Denial matches</th>
            <td class="govuk-table__cell">
				{% if case.data.denial_matches %}
					{{ case.data.denial_matches|get_denial_references|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">Sanction matches</th>
            <td class="govuk-table__cell">
				{% if case.data.sanction_matches %}
					{{ case.data.sanction_matches|get_sanction_list|join:", " }}
				{% else %}
					<span class="govuk-hint govuk-!-margin-0">
						None
					</span>
				{% endif %}
            </td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">End-use</th>
            <td class="govuk-table__cell">{{ case.data.intended_end_use }}</td>
        </tr>
        <tr class="govuk-table__row app-table__row">
            <th scope="row" class="govuk-table__header">End-user documents</th>
            <td class="govuk-table__cell">
				{% for document in case.data.end_user.documents %}
					<a target="_blank" href="{% url 'cases:document' queue_pk=queue.id pk=case.id file_pk=document.id %}" class="govuk-link--no-visited-state">
						{% if document.type == "end_user_undertaking_document" or document.type == "supporting_document" %}End-user document{% elif document.type == "end_user_english_translation_document" %}English translation{% elif document.type == "end_user_english_translation_document" %}Company letterhead{% endif %} ({{ document.name|document_extension|upper }} opens in new tab)
					</a><br/>
				{% endfor %}
            </td>
        </tr>
    </tbody>
</table>
