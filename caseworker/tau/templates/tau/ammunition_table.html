{% load advice_tags tau_tags %}
<table id="table-products-{{ forloop.counter }}" class="govuk-table">
    <tbody class="govuk-table__body">
      {% with good_on_application=good good=good.good firearm_details=good.firearm_details organisation_documents=good.organisation_documents %}
        {% if good.is_document_available %}
          <tr class="govuk-table__row">
            <td class="govuk-table__cell">
              {% for document in good.documents %}
                <a target="_blank" href="{{ document.url }}" class="govuk-link--no-visited-state">
                  Product document ({{ document.type }}, opens in new tab)
                </a>
              {% endfor %}
            </td>
            <td class="govuk-table__header"></td>
          </tr>
        {% else %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Explain why you are not able to upload a product document</td>
            <td class="govuk-table__cell">{{ good.no_document_comments }}</td>
          </tr>
        {% endif %}
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Select the type of firearm product</td>
          <td class="govuk-table__cell">{{ firearm_details.type.value }}</td>
        </tr>
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Part number (optional)</td>
          <td class="govuk-table__cell">{{ good.part_number }}</td>
        </tr>
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Does the product have a government security grading or classification?</td>
          <td class="govuk-table__cell">{{ good.is_pv_graded|title }}</td>
        </tr>
        {% if good.is_pv_graded == "yes" %}
          {% if good.pv_grading_details.prefix %}
            <tr class="govuk-table__row">
              <td class="govuk-table__header">Enter a prefix (optional)</td>
              <td class="govuk-table__cell">{{ good.pv_grading_details.prefix }}</td>
            </tr>
          {% endif %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">What is the security grading or classification?</td>
            <td class="govuk-table__cell">{{ good.pv_grading_details.grading.value }}</td>
          </tr>
          {% if good.pv_grading_details.suffix %}
            <tr class="govuk-table__row">
              <td class="govuk-table__header">Enter a suffix (optional)</td>
              <td class="govuk-table__cell">{{ good.pv_grading_details.suffix }}</td>
            </tr>
          {% endif %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Name and address of the issuing authority</td>
            <td class="govuk-table__cell">{{ good.pv_grading_details.issuing_authority|linebreaksbr }}</td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Reference</td>
            <td class="govuk-table__cell">{{ good.pv_grading_details.reference }}</td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Date of issue</td>
            <td class="govuk-table__cell">
              {{ good.pv_grading_details.date_of_issue|format_date }}
            </td>
          </tr>
        {% endif %}
        <tr class="govuk-table__row">
          <td class="govuk-table__header">What is the calibre of the product?</td>
          <td class="govuk-table__cell">{{ good.firearm_details.calibre }}</td>
        </tr>
        {% if firearm_details.is_covered_by_firearm_act_section_one_two_or_five == "Yes" %}
          {% if firearm_details.firearms_act_section == "firearms_act_section5" %}
            {% with section5_document=organisation_documents.section_five_certificate %}
              <tr class="govuk-table__row">
                <td class="govuk-table__header">
                  Is the product covered by section 5 of the Firearm Act 1968?
                </td>
                <td class="govuk-table__cell">
                  {% if firearm_details.firearms_act_section == "Unsure" %}
                    Don't know
                  {%  else  %}
                    Section 5
                  {%  endif %}
                </td>
              </tr>
              <tr class="govuk-table__row">
                <td class="govuk-table__header">Upload your section 5 letter of authority</td>
                <td class="govuk-table__cell">
                  {% if firearm_details.section_certificate_missing %}
                    I do not have a section 5 letter of authority
                    <div class="govuk-hint">
                      {{ firearm_details.section_certificate_missing_reason }}
                    </div>
                  {% else %}
                    {% if section5_document.document.safe %}
                      {{ section5_document.document.name }}
                    {% else %}
                      {{ section5_document.document.name }}
                    {% endif %}
                  {% endif %}
                </td>
                {% if not firearm_details.section_certificate_missing %}
                  <tr class="govuk-table__row">
                    <td class="govuk-table__header">Certificate number</td>
                    <td class="govuk-table__cell">{{ section5_document.reference_code }}</td>
                  </tr>
                  <tr class="govuk-table__row">
                    <td class="govuk-table__header">Expiry date</td>
                    <td class="govuk-table__cell">{{ section5_document.expiry_date }}</td>
                  </tr>
                {% endif %}
              </tr>
            {% endwith %}                  
          {% endif %}
        {% endif %}
        <tr class="govuk-table__row">
          <td class="govuk-table__header">
            Will the product be incorporated into another item before it is onward exported?
          </td>
          <td class="govuk-table__cell">
            {% if firearm_details.is_onward_exported is not None %}
              {{ firearm_details.is_onward_exported|yesno|capfirst }}
            {% else %}
              N/A
            {% endif %}
          </td>
        </tr>
        {% if firearm_details.is_onward_exported %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">
              Will the item be altered or processed before it is exported again?
            </td>
            <td class="govuk-table__cell">
              {{ firearm_details.is_onward_altered_processed|yesno|capfirst }}
              {% if firearm_details.is_onward_altered_processed %}
                  <div class="govuk-hint">
                      {{ firearm_details.is_onward_altered_processed_comments }}
                  </div>
              {% endif %}
            </td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__header">
              Will the product be incorporated into another item before it is onward exported?
            </td>
            <td class="govuk-table__cell">
              {{ firearm_details.is_onward_incorporated|yesno|capfirst }}
              {% if firearm_details.is_onward_incorporated %}
                  <div class="govuk-hint">
                      {{ firearm_details.is_onward_incorporated_comments }}
                  </div>
              {% endif %}
            </td>
          </tr>
        {% endif %}
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Does the product have a valid proof mark?</td>
          <td class="govuk-table__cell">{{ firearm_details.has_proof_mark|yesno|title }}</td>
        </tr>
        {% if firearm_details.has_proof_mark is False %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Explain why the product doesn’t have a valid proof mark</td>
            <td class="govuk-table__cell">{{ firearm_details.no_proof_mark_details }}</td>
          </tr>
        {% endif %}
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Number of items</td>
          <td class="govuk-table__cell">{{ firearm_details.number_of_items }}</td>
        </tr>
        <tr class="govuk-table__row">
          <td class="govuk-table__header">Total value</td>
          <td class="govuk-table__cell">£{{ good_on_application.value|floatformat:2 }}</td>
        </tr>
        <tr class="govuk-table__row">
          <td class="govuk-table__header">
            Will each product have a serial number or other identification marking?
          </td>
          <td class="govuk-table__cell">
            {% if firearm_details.serial_numbers_available == "AVAILABLE" %}
                Yes, I can add serial numbers now
            {% elif firearm_details.serial_numbers_available == "LATER" %}
                Yes, I can add serial numbers later
            {% else %}
                No
                {% if firearm_details.no_identification_markings_details %}
                    <div class="govuk-hint">
                        {{ firearm_details.no_identification_markings_details }}
                    </div>
                {% endif %}
            {% endif %}
          </td>
        </tr>
        {% if good.firearm_details.serial_numbers_available != "NOT_AVAILABLE" %}
          <tr class="govuk-table__row">
            <td class="govuk-table__header">Enter serial numbers or other identification markings</td>
            <td class="govuk-table__cell">
              {% include "tau/includes/serial_numbers.html" %}
            </td>
          </tr>
        {% endif %}
      {% endwith %}
    </tbody>
  </table>
