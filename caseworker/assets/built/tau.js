!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){return r(e)}function u(e){return e&&e.constructor===Symbol?"symbol":typeof e}function l(e,n){return!n||"object"!==u(n)&&"function"!=typeof n?t(e):n}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=o(e);if(t){var i=o(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return l(this,n)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function v(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||m(e)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return f(e)}(e)||m(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y,_="Select all",I=function(){"use strict";function e(t,s){n(this,e),this.$selectAllButton=t,this.$checkboxes=s,this.isAllSelected=!1}return i(e,[{key:"init",value:function(){var e=this;this.$selectAllButton.addEventListener("click",(function(t){return e.handleSelectAllButtonClick(t)}));var t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.addEventListener("input",(function(){return e.setSelectAll()}))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}this.setSelectAll()}},{key:"handleSelectAllButtonClick",value:function(e){e.preventDefault(),this.setCheckboxesChecked(!this.isAllSelected)}},{key:"setCheckboxesChecked",value:function(e){var t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;o.checked=e,o.dispatchEvent(new Event("input"))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}}},{key:"getNumChecked",value:function(){var e=0,t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){e+=i.value.checked?1:0}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}return e}},{key:"setSelectAll",value:function(){this.getNumChecked()===this.$checkboxes.length?(this.$selectAllButton.textContent="Deselect all",this.isAllSelected=!0):(this.$selectAllButton.textContent=_,this.isAllSelected=!1)}}]),e}(),k="Show all",S=function(){"use strict";function e(t,s){n(this,e),this.$expandAllButton=t,this.$details=s,this.isAllExpanded=!1}return i(e,[{key:"init",value:function(){var e=this;this.$expandAllButton.addEventListener("click",(function(t){return e.handleExpandAllButtonClick(t)}));var t=!0,n=!1,s=void 0;try{for(var i,r=this.$details[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.addEventListener("toggle",(function(){return e.setExpandAll()}))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}this.setExpandAll()}},{key:"handleExpandAllButtonClick",value:function(e){e.preventDefault(),this.setDetailsOpen(!this.isAllExpanded)}},{key:"setDetailsOpen",value:function(e){var t=!0,n=!1,s=void 0;try{for(var i,r=this.$details[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;o.open=e,o.dispatchEvent(new Event("toggle"))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}}},{key:"getNumOpened",value:function(){var e=0,t=!0,n=!1,s=void 0;try{for(var i,r=this.$details[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){e+=i.value.open?1:0}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}return e}},{key:"setExpandAll",value:function(){this.getNumOpened()===this.$details.length?(this.$expandAllButton.textContent="Hide all",this.isAllExpanded=!0):(this.$expandAllButton.textContent=k,this.isAllExpanded=!1)}}]),e}(),b=function(){"use strict";function e(t,s,i){n(this,e),this.$checkboxes=t,this.$elementToToggleClass=s,this.toggleClass=i}return i(e,[{key:"init",value:function(){var e=this,t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.addEventListener("input",(function(t){return e.handleCheckboxInput(t)}))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}this.setClass()}},{key:"handleCheckboxInput",value:function(){this.setClass()}},{key:"getNumChecked",value:function(){var e=0,t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){e+=i.value.checked?1:0}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}return e}},{key:"setClass",value:function(){var e=0===this.getNumChecked();this.$elementToToggleClass.classList.toggle(this.toggleClass,e)}}]),e}(),w=function(){"use strict";function e(t){n(this,e),this.$button=t}return i(e,[{key:"init",value:function(){var e=this;this.$button.addEventListener("click",(function(t){return e.handleClick(t)}))}},{key:"handleClick",value:function(){var e=this;setTimeout((function(){return e.$button.disabled=!0}),0)}}]),e}(),x=function(){"use strict";function e(t){n(this,e),this.$headline=t}return i(e,[{key:"getText",value:function(e){if(1===e.length){var t=e[0].name;return"Assessing ".concat(t)}return"Assessing ".concat(e.length," products")}},{key:"setProducts",value:function(e){this.$headline.textContent=this.getText(e)}}]),e}(),L=function(){"use strict";function e(t,s,i){n(this,e),this.$checkboxes=t,this.onSelectProducts=i,this.products={};var r=!0,o=!1,u=void 0;try{for(var l,a=s[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var c=l.value;this.products[c.id]=c}}catch(e){o=!0,u=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw u}}}return i(e,[{key:"init",value:function(){var e=this,t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.addEventListener("input",(function(){e.onSelectProducts(e.getSelectedProducts())}))}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}this.onSelectProducts(this.getSelectedProducts())}},{key:"getSelectedProducts",value:function(){var e=[],t=!0,n=!1,s=void 0;try{for(var i,r=this.$checkboxes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;o.checked&&e.push(this.products[o.value])}}catch(e){n=!0,s=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw s}}return e}}]),e}(),E=function(){"use strict";function e(){n(this,e),this.suggestions=[],this.seenExporterSuggestions=new Set,this.seenAssessedSuggestions=new Set}return i(e,[{key:"getSuggestionKey",value:function(e){return e.sort().join("|")}},{key:"addSuggestion",value:function(e,t,n){var s=this.getSuggestionKey(t);e.has(s)||(e.add(s),this.suggestions.push([t,n]))}},{key:"addExporterSuggestion",value:function(e,t){this.addSuggestion(this.seenExporterSuggestions,e,t)}},{key:"addAssessedSuggestion",value:function(e,t){this.addSuggestion(this.seenAssessedSuggestions,e,t)}}]),e}(),C=function(){"use strict";function e(t,s){n(this,e),this.$suggestionsContainer=t,this.onSelectSuggestions=s}return i(e,[{key:"getSuggestionButton",value:function(e){var t=document.createElement("button");return t.classList.add("lite-button--link"),t.textContent=e,t}},{key:"getSuggestionText",value:function(e){return e.join(", ")}},{key:"getExporterSuggestionText",value:function(e){var t=this.getSuggestionText(e);return"Select exporter suggestion ".concat(t)}},{key:"getAssessedSuggestionText",value:function(e){var t=this.getSuggestionText(e);return"Copy previous assessment ".concat(t)}},{key:"getSuggestions",value:function(e){var t=new E,n=!0,s=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var u=r.value.controlListEntries,l=u.exporter,a=u.precedents;l&&l.length>0&&t.addExporterSuggestion(l,this.getExporterSuggestionText(l));var c=!0,h=!1,d=void 0;if(a)try{for(var m,f=a[Symbol.iterator]();!(c=(m=f.next()).done);c=!0){var v=m.value;v.length&&t.addAssessedSuggestion(v,this.getAssessedSuggestionText(v))}}catch(e){h=!0,d=e}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}}}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return t.suggestions}},{key:"setProducts",value:function(e){this.$suggestionsContainer.innerHTML="";var t=this.getSuggestions(e),n=!0,s=!1,i=void 0;try{for(var r,o=this,u=function(e,t){var n=g(t.value,2),s=n[0],i=n[1],r=o,u=o.getSuggestionButton(i);u.addEventListener("click",(function(e){return r.handleSuggestionButtonClick(e,s)})),o.$suggestionsContainer.append(u)},l=t[Symbol.iterator]();!(n=(r=l.next()).done);n=!0)u(0,r)}catch(e){s=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(s)throw i}}}},{key:"handleSuggestionButtonClick",value:function(e,t){e.preventDefault(),this.onSelectSuggestions(t)}}]),e}(),O=function(){"use strict";function e(t){n(this,e),this.controlListEntriesSelector=t}return i(e,[{key:"setSuggestions",value:function(e){document.querySelector(this.controlListEntriesSelector).tokenfield.addItems(e.map((function(e){return{id:e,name:e}})))}}]),e}(),A=function(){"use strict";function e(t,s){n(this,e),this.controlListEntriesSelector=t,this.$noControlListCheckbox=s}return i(e,[{key:"init",value:function(){var e=this;this.$noControlListCheckbox.addEventListener("input",(function(t){return e.handleNoControlListCheckboxInput(t)}))}},{key:"emptyTokenField",value:function(){document.querySelector(this.controlListEntriesSelector).tokenfield.emptyItems()}},{key:"displayNoCLEEntry",value:function(){var e=this,t=document.querySelector(this.controlListEntriesSelector);t.querySelector(".tokenfield-input").style.display="none";var n=t.querySelector(".tokenfield-set ul"),s=document.createElement("li");s.classList.add("tokenfield-set-item","tau-none-item");var i=document.createElement("span");i.classList.add("item-label"),i.textContent="None";var r=document.createElement("a");r.classList.add("item-remove"),r.tabIndex=-1,r.textContent="×",r.addEventListener("click",(function(){e.setCheckbox(!1)})),s.append(i,r),n.appendChild(s)}},{key:"removeNoCLEEntry",value:function(){var e=document.querySelector(this.controlListEntriesSelector);e.querySelector(".tokenfield-input").style.removeProperty("display");var t=e.querySelector(".tokenfield-set .tau-none-item");null==t||t.remove()}},{key:"handleNoControlListCheckboxInput",value:function(){this.$noControlListCheckbox.checked?(this.emptyTokenField(),this.displayNoCLEEntry()):this.removeNoCLEEntry()}},{key:"setCheckbox",value:function(e){this.$noControlListCheckbox.checked=e,this.$noControlListCheckbox.dispatchEvent(new Event("input"))}},{key:"reset",value:function(){this.setCheckbox(!1)}}]),e}(),D={},T="object"==typeof Reflect?Reflect:null,N=T&&"function"==typeof T.apply?T.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};y=T&&"function"==typeof T.ownKeys?T.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var j=Number.isNaN||function(e){return e!=e};function P(){P.init.call(this)}(D=P).once=function(e,t){return new Promise((function(n,s){var i=function(n){e.removeListener(t,r),s(n)},r=function(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))};K(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&K(e,"error",t,n)}(e,i,{once:!0})}))},P.EventEmitter=P,P.prototype._events=void 0,P.prototype._eventsCount=0,P.prototype._maxListeners=void 0;var R=10;function $(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+(void 0===e?"undefined":u(e)))}function q(e){return void 0===e._maxListeners?P.defaultMaxListeners:e._maxListeners}function M(e,t,n,s){var i,r,o,u;if($(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),(i=q(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function B(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function F(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=B.bind(s);return i.listener=n,s.wrapFn=i,i}function z(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):V(i,i.length)}function H(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function V(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function K(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+(void 0===e?"undefined":u(e)));e.addEventListener(t,(function i(r){s.once&&e.removeEventListener(t,i),n(r)}))}}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return R},set:function(e){if("number"!=typeof e||e<0||j(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");R=e}}),P.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||j(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},P.prototype.getMaxListeners=function(){return q(this)},P.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s="error"===e,i=this._events;if(void 0!==i)s=s&&void 0===i.error;else if(!s)return!1;if(s){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var o=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw o.context=r,o}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)N(u,this,t);else{var l=u.length,a=V(u,l);for(n=0;n<l;++n)N(a[n],this,t)}return!0},P.prototype.addListener=function(e,t){return M(this,e,t,!1)},P.prototype.on=P.prototype.addListener,P.prototype.prependListener=function(e,t){return M(this,e,t,!0)},P.prototype.once=function(e,t){return $(t),this.on(e,F(this,e,t)),this},P.prototype.prependOnceListener=function(e,t){return $(t),this.prependListener(e,F(this,e,t)),this},P.prototype.removeListener=function(e,t){var n,s,i,r,o;if($(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},P.prototype.off=P.prototype.removeListener,P.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,r=Object.keys(n);for(s=0;s<r.length;++s)"removeListener"!==(i=r[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},P.prototype.listeners=function(e){return z(this,e,!0)},P.prototype.rawListeners=function(e){return z(this,e,!1)},P.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):H.call(e,t)},P.prototype.listenerCount=H,P.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};var W={},X=/[\\^$.*+?()[\]{}|]/g,U=RegExp(X.source),J=document.createElement("div"),G={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <input class="tokenfield-copy-helper"\n        style="display:none;position:fixed;top:-1000px;right:1000px;"\n        tabindex="-1"\n        type="text"\n      />\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <a href="#" class="item-remove" tabindex="-1">×</a>\n      <input class="item-input" type="hidden" />\n    </li>'};function Q(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function Y(e,t){return e.indexOf(t)>=0}function Z(e){return e.nodeName?e:"string"==typeof e?document.querySelector(e):null}function ee(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),J.innerHTML="",J.innerHTML=e,!0===t?J.childNodes:J.childNodes[0])}function te(e){return e.key||e.keyIdentifier?e.key||String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16)):null}var ne,se=function(e){"use strict";d(r,e);var s=a(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,r),e=s.call(this);var o={_defaults:{focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{},delimiters:{}},_options:{el:null,form:!0,mode:"tokenfield",addItemOnBlur:!1,addItemsOnPaste:!1,keepItemsOrder:!0,setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,minLength:0,keys:{17:"ctrl",16:"shift",91:"meta",8:"delete",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"select",67:"copy",88:"cut",9:"delimiter",13:"delimiter",108:"delimiter"},matchRegex:"{value}",matchFlags:"i",matchStart:!1,matchEnd:!1,delimiters:[],copyProperty:"name",copyDelimiter:", ",remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{},headers:{}},placeholder:null,inputType:"text",minChars:2,maxSuggest:10,maxSuggestWindow:10,filterSetItems:!0,filterMatchCase:!1,singleInput:!1,singleInputValue:"id",singleInputDelimiter:", ",itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name",validateNewItem:null}},u=o._defaults,l=o._options;e.id=Q(),e.key="key_".concat(e.id),e._vars=Object.assign({},u),e._options=Object.assign({},l,i),e._options.keys=Object.assign({},l.keys,i.keys),e._options.remote=Object.assign({},l.remote,i.remote),e._templates=Object.assign({},G,i.templates),e._vars.setItems=e._prepareData(e.remapData(e._options.setItems||[])),e._focused=!1,e._input=null,e._form=!1,e._html={};var a=e._options;a.delimiters.forEach((function(t){e._vars.delimiters[t]=!0}));var c=Z(a.el);if(!c)throw new Error("Selector: DOM Element ".concat(a.el," not found."));if(e.el=c,a.singleInput){var h=Z(a.singleInput);e._input=h||e.el}if(e.el.tokenfield=t(e),null===a.placeholder&&(a.placeholder=a.el.placeholder||""),!a.form)throw new Error("Cannot create tokenfield without DOM Element.");var d=!1;if(a.form.nodeName)d=a.form;else if(!0===a.form)for(var m=e.el;m.parentNode;){if("FORM"===m.nodeName){d=m;break}m=m.parentNode}else if("string"==typeof d&&!(d=document.querySelector(d)))throw new Error("Selector: DOM Element ".concat(a.form," not found."));return e._form=d,W[e.id]=t(e),e._render(),e}return i(r,[{key:"_render",value:function(){var e=this._options,t=this._html;return"tokenfield"===e.mode?t.container=ee(this._templates.containerTokenfield):t.container=ee(this._templates.containerList),t.suggest=t.container.querySelector(".tokenfield-suggest"),t.suggestList=t.container.querySelector(".tokenfield-suggest-list"),t.items=t.container.querySelector(".tokenfield-set > ul"),t.input=t.container.querySelector(".tokenfield-input"),t.input.setAttribute("type",e.inputType),"tokenfield"===e.mode?t.input.placeholder=this._vars.setItems.length?"":e.placeholder:t.input.placeholder=e.placeholder,t.copyHelper=t.container.querySelector(".tokenfield-copy-helper"),e.el.style.display="none",t.suggest.style.display="none",this._renderSizer(),t.container.tokenfield=this,e.el.parentElement.insertBefore(t.container,e.el),t.container.insertBefore(e.el,t.container.firstChild),this._setEvents(),this._renderItems(),"tokenfield"===e.mode&&this._minimizeInput()._resizeInput(),this}},{key:"_renderSizer",value:function(){var e=this._html,t=this._getBounds(),n=window.getComputedStyle(e.container),s=parseInt(n.paddingLeft,10)+parseInt(n.paddingRight,10),i={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:t.width-s+"px",position:"fixed",top:"-10000px",left:"10000px",fontSize:n.fontSize,paddingLeft:n.paddingLeft,paddingRight:n.paddingRight};for(var r in e.sizer=document.createElement("div"),e.sizer.id="tokenfield-sizer-"+this.id,i)e.sizer.style[r]=i[r];e.container.appendChild(e.sizer)}},{key:"_minimizeInput",value:function(){return this._html.input.style.width="20px",this}},{key:"_refreshInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._vars,n=this._html;if(e&&(n.input.value=""),"tokenfield"===this._options.mode){this._resizeInput();var s=t.setItems.length?"":this._options.placeholder;n.input.setAttribute("placeholder",s)}else"list"===this._options.mode&&n.input.setAttribute("placeholder",this._options.placeholder);return this}},{key:"_resizeInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this._html,n=this._getBounds(),s=window.getComputedStyle(t.container),i=parseInt(s.paddingRight,10)+parseInt(s.borderRightWidth,10),r=i+parseInt(s.paddingLeft,10)+parseInt(s.borderLeftWidth,10);if(t.sizer.innerHTML=e,t.sizer.style.maxWidth=n.width-i+"px",0!==n.width){t.input.style.width="20px";var o=t.sizer.getBoundingClientRect(),u=t.input.getBoundingClientRect(),l=n.width-(u.left-n.left)-i;o.width>l?t.input.style.width=n.width-r-1+"px":t.input.style.width=l-1+"px"}else t.input.style.width="100%"}},{key:"_fetchData",value:function(e){var t=this,n=this._vars,s=this._options,i=s.remote,r=Object.assign({},s.params);for(var o in i.params)r[o]=i.params[o];i.limit&&(r[i.limit]=s.remote.limit),r[i.queryParam]=e,r[i.timestampParam]=Math.round((new Date).getTime()/1e3),n.xhr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new XMLHttpRequest,i=t.url,r=[];for(var o in e)r.push("".concat(o,"=").concat(encodeURIComponent(e[o])));var u=r.join("&");for(var l in"get"===t.type.toLowerCase()&&(i+="?"+u),s.open(t.type,i,!0),t.headers){var a=t.headers[l];"function"==typeof a&&(a=a(e,t)),s.setRequestHeader(l,a)}return n&&(s.onreadystatechange=n),s.send(e),s}(r,s.remote,(function(){if(n.xhr&&4==n.xhr.readyState){if(200==n.xhr.status){var i=JSON.parse(n.xhr.responseText);n.cache[e]=i;var r=t._prepareData(t.remapData(i)),o=t._filterData(e,r);n.suggestedItems=s.filterSetItems?t._filterSetItems(o):o,t.showSuggestions()}else if(n.xhr.status>0)throw new Error("Error while loading remote data.");t._abortXhr()}}))}},{key:"remapData",value:function(e){return e}},{key:"_prepareData",value:function(e){var t=this;return e.map((function(e){return Object.assign({},e,c({},t.key,Q()))}))}},{key:"_filterData",value:function(e,t){var n,s=this._options,i=s.matchRegex.replace("{value}",(n=function(e){if("string"==typeof e)return e;if(null===e)return"";var t=e+"";return"0"===t&&1/e==-1/0?"-0":t}(n=e))&&U.test(n)?n.replace(X,"\\$&"):n);s.matchStart?i="^"+i:s.matchEnd&&(i+="$");var r=new RegExp(i,s.matchFlags);return t.filter((function(e){return r.test(e[s.itemData])}))}},{key:"_abortXhr",value:function(){var e=this._vars;null!==e.xhr&&(e.xhr.abort(),e.xhr=null)}},{key:"_filterSetItems",value:function(e){var t=this._options.itemValue,n=this._vars;if(!n.setItems.length)return e;var s=n.setItems.map((function(e){return e[t]}));return e.filter((function(e){return-1===s.indexOf(e[t])}))}},{key:"_setEvents",value:function(){var e=this._vars,t=this._html;e.events.onClick=this._onClick.bind(this),e.events.onMouseDown=this._onMouseDown.bind(this),e.events.onMouseOver=this._onMouseOver.bind(this),e.events.onFocus=this._onFocus.bind(this),e.events.onResize=this._onResize.bind(this),e.events.onReset=this._onReset.bind(this),e.events.onKeyDown=this._onKeyDown.bind(this),e.events.onFocusOut=this._onFocusOut.bind(this),t.container.addEventListener("click",e.events.onClick),1===Object.keys(W).length&&(document.addEventListener("mousedown",e.events.onMouseDown),window.addEventListener("resize",e.events.onResize)),this._form&&this._form.nodeName&&this._form.addEventListener("reset",e.events.onReset),t.suggestList.addEventListener("mouseover",e.events.onMouseOver),t.input.addEventListener("focus",e.events.onFocus)}},{key:"_onMouseOver",value:function(e){var t=e.target;t.classList.contains("tokenfield-suggest-item")&&([].slice.call(this._html.suggestList.querySelectorAll(".selected")).forEach((function(e){e!==t&&e.classList.remove("selected")})),t.classList.add("selected"),this._selectItem(t.key,!1),this._refreshItemsSelection())}},{key:"_onReset",value:function(){this.setItems(this._options.setItems)}},{key:"_onFocus",value:function(){var e=this._vars,t=this._html,n=this._options;t.input.removeEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("focusout",e.events.onFocusOut),n.addItemsOnPaste&&(e.events.onPaste=this._onPaste.bind(this),t.input.addEventListener("paste",e.events.onPaste)),this._focused=!0,this._html.container.classList.add("focused"),this._resizeInput(),t.input.value.trim().length>=n.minChars&&this.showSuggestions()}},{key:"_onFocusOut",value:function(e){var t=this._vars,n=this._options,s=this._html;if(s.input.removeEventListener("keydown",t.events.onKeyDown),s.input.removeEventListener("focusout",t.events.onFocusOut),void 0!==t.events.onPaste&&s.input.removeEventListener("paste",t.events.onPaste),!e.relatedTarget||e.relatedTarget!==s.copyHelper){var i=n.multiple&&!n.maxItems||!n.multiple&&!t.setItems.length||n.multiple&&n.maxItems&&t.setItems.length<n.maxItems;this._focused&&n.addItemOnBlur&&i&&this._newItem(s.input.value)?this._renderItems()._refreshInput():this._defocusItems()._renderItems(),this._focused=!1,this._html.container.classList.remove("focused")}}},{key:"_onMouseDown",value:function(e){var t=null;for(var n in W)if(W[n]._html.container.contains(e.target)){t=W[n];break}if(t){for(var s in W)s!==t.id&&(W[s].hideSuggestions(),W[s].blur());e.target!==t._html.input&&e.preventDefault()}else for(var i in W)W[i].hideSuggestions(),W[i].blur()}},{key:"_onResize",value:function(){for(var e in W)W[e]._resizeInput(W[e]._html.input.value)}},{key:"_onPaste",value:function(e){var t=this,n=this._vars,s=this._options,i=e.clipboardData.getData("text"),r=[i];if(s.delimiters.length){var o=s.delimiters.join("|"),u=new RegExp("(".concat(o,")"),"ig");r=i.split(u)}if(r.map((function(e){return e.trim()})).filter((function(e){return e.length>0&&e.length>=s.minLength&&void 0===n.delimiters[e]})).map((function(e){return t._newItem(e)})).length){var l=this;setTimeout((function(){l._renderItems()._refreshInput()._deselectItems().hideSuggestions()}),1),e.preventDefault()}}},{key:"_onKeyDown",value:function(e){var t=this,n=this._vars,s=this._options,i=this._html;s.maxItems&&n.setItems.length>=s.maxItems&&e.preventDefault(),"tokenfield"===s.mode&&setTimeout((function(){t._resizeInput(i.input.value)}),1);var r=te(e);if(void 0!==s.keys[e.keyCode]||Y(s.delimiters,r)){if(this._keyAction(e))return!0}else this._defocusItems()._refreshItems();clearTimeout(n.timer),this._abortXhr(),(!s.maxItems||n.setItems.length<s.maxItems)&&setTimeout((function(){t._keyInput(e)}),1)}},{key:"_keyAction",value:function(e){this.key;var t=null,n=this._vars,s=this._options,i=this._html,r=s.keys[e.keyCode],o=i.input.value.trim(),u=te(e);Y(s.delimiters,u)&&void 0===r&&(r="delimiter");var l=this._getSelectedItems();switch(l.length&&(t=l[0]),r){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"left":(this.getFocusedItems().length||!i.input.selectionStart&&!i.input.selectionEnd)&&(this._focusPrevItem(e.shiftKey),e.preventDefault());break;case"right":(this.getFocusedItems().length||i.input.selectionStart===o.length)&&(this._focusNextItem(e.shiftKey),e.preventDefault());break;case"delimiter":if(this._abortXhr(),this._defocusItems(),!s.multiple&&n.setItems.length>=1)return!1;o=this.onInput(o,e),t?this._addItem(t):o.length&&(t=this._newItem(o)),t&&this._minimizeInput()._renderItems().focus()._refreshInput()._refreshSuggestions()._deselectItems(),e.preventDefault();break;case"select":if(o.length||!e.ctrlKey&&!e.metaKey)return!1;this._vars.setItems.forEach((function(e){e.focused=!0})),this._refreshItems();break;case"cut":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy()._delete(e);break;case"copy":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy();break;case"delete":var a=this;this._abortXhr();var c=this.getFocusedItems();!i.input.selectionEnd&&8===e.keyCode||i.input.selectionStart===o.length&&46===e.keyCode||c.length?this._delete(e):n.timer=setTimeout((function(){a._keyInput(e)}),s.delay)}return!0}},{key:"_copy",value:function(){var e=this._options,t=this._html,n=this.getFocusedItems().map((function(t){return t[e.copyProperty]})).join(e.copyDelimiter);return t.copyHelper.style.display="block",t.copyHelper.value=n,t.copyHelper.focus(),t.copyHelper.select(),document.execCommand("copy"),t.copyHelper.style.display="none",t.copyHelper.value="",t.input.focus(),this}},{key:"_delete",value:function(e){var t=this._vars,n=this._options,s=this.key,i=this._html,r=this.getFocusedItems();if("tokenfield"===n.mode&&t.setItems.length)if(r.length){var o=this;r.forEach((function(e){o._removeItem(e[s])})),this._refreshSuggestions()._keyInput(e)}else i.input.selectionStart||this._focusItem(t.setItems[t.setItems.length-1][s]);else if(r.length){var u=this;r.forEach((function(e){u._removeItem(e[s])})),this._refreshSuggestions()._keyInput(e)}return this._minimizeInput()._renderItems()._refreshInput(!1),this}},{key:"_keyInput",value:function(e){var t=this._vars,n=this._options,s=this._html;this._defocusItems()._refreshItems();var i=this.onInput(s.input.value.trim(),e);if("keydown"===e.type&&this.emit("input",this,i,e),i.length<n.minChars)return this.hideSuggestions(),!1;if(!n.multiple&&t.setItems.length>=1)return!1;if(void 0===t.cache[i]){var r=this;if(n.remote.url)t.timer=setTimeout((function(){r._fetchData(i)}),n.delay);else if(!n.remote.url&&n.items.length){var o=this._prepareData(n.items),u=this._filterData(i,o);t.suggestedItems=n.filterSetItems?this._filterSetItems(u):u,this.showSuggestions()}}else{var l=this._prepareData(this.remapData(t.cache[i])),a=this._filterData(i,l);t.suggestedItems=n.filterSetItems?this._filterSetItems(a):a,this.showSuggestions()}return this}},{key:"_onClick",value:function(e){var t=e.target;if(t.classList.contains("item-remove"))e.preventDefault(),this._removeItem(t.key)._defocusItems()._minimizeInput()._renderItems()._refreshInput(!1)._keyInput(e);else if(t.classList.contains("tokenfield-suggest-item")){var n=this._getSuggestedItem(t.key);this._addItem(n)._minimizeInput()._renderItems()._refreshInput()._refreshSuggestions()}else{var s=function(e){for(var t=[e];e.parentNode;)e=e.parentNode,t.push(e);return t}(t).filter((function(e){return e.classList&&e.classList.contains("tokenfield-set-item")}))[0];s?(this._focusItem(s.key,e.shiftKey,e.ctrlKey||e.metaKey,!0),this._refreshItems()):this._keyInput(e)}this.focus()}},{key:"_selectPrevItem",value:function(){var e=this.key,t=this._options,n=this._vars.suggestedItems,s=this._getSelectedItemIndex();return n.length?(null!==s?0===s?t.newItems?this._deselectItems():this._selectItem(n[n.length-1][e]):this._selectItem(n[s-1][e]):this._selectItem(n[n.length-1][e]),this):this}},{key:"_selectNextItem",value:function(){var e=this.key,t=this._options,n=this._vars.suggestedItems,s=this._getSelectedItemIndex();return n.length?(null!==s?s===n.length-1?t.newItems?this._deselectItems():this._selectItem(n[0][e]):this._selectItem(n[s+1][e]):this._selectItem(n[0][e]),this):this}},{key:"_focusPrevItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,n=this._vars.setItems,s=this._getFocusedItemIndex();if(!n.length)return this;if(null!==s)if(0!==s||e)if(0===s&&e){var i=this._getFocusedItemIndex(!0);this._defocusItem(n[i][t])}else this._focusItem(n[s-1][t],e,!1,!0);else this._defocusItems();else this._focusItem(n[n.length-1][t],!1,!1,!0);return this._refreshItems(),this}},{key:"_focusNextItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,n=this._vars.setItems,s=this._getFocusedItemIndex(!0);return n.length?(null!==s?s!==n.length-1||e?s===n.length-1&&e?this._focusItem(n[0][t],e):this._focusItem(n[s+1][t],e):this._defocusItems():this._focusItem(n[0][t],!1),this._refreshItems(),this):this}},{key:"_getSelectedItems",value:function(){var e=this.key,t=this._vars.setItems.map((function(t){return t[e]}));return this._vars.suggestedItems.filter((function(n){return n.selected&&t.indexOf(n[e])<0}))}},{key:"_selectItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this;this._vars.suggestedItems.forEach((function(s){if(s.selected=s[n.key]===e,s.selected&&t){var i=parseInt(n._html.suggest.style.maxHeight,10);if(i){var r=n._html.suggestList.getBoundingClientRect(),o=s.el.getBoundingClientRect(),u=o.top-r.top,l=u+o.height;l>=i+n._html.suggest.scrollTop?n._html.suggest.scrollTop=l-i:u<n._html.suggest.scrollTop&&(n._html.suggest.scrollTop=u)}}}))}},{key:"_deselectItem",value:function(e){var t=this;return this._vars.suggestedItems.every((function(n){return n[t.key]!==e||(n.selected=!1,!1)})),this}},{key:"_deselectItems",value:function(){return this._vars.suggestedItems.forEach((function(e){e.selected=!1})),this}},{key:"_refreshItemsSelection",value:function(){this._vars.suggestedItems.forEach((function(e){e.selected&&e.el?e.el.classList.add("selected"):e.el&&e.el.classList.remove("selected")}))}},{key:"_getSelectedItemIndex",value:function(){var e=null;return this._vars.suggestedItems.every((function(t,n){return!t.selected||(e=n,!1)})),e}},{key:"_getFocusedItemIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;return this._vars.setItems.every((function(n,s){return!(n.focused&&(t=s,!e))})),t}},{key:"_getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var n=this._filterItems(this._vars.setItems,e,t);return n.length?n[0]:null}},{key:"_getSuggestedItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var n=this._filterItems(this._vars.suggestedItems,e,t);return n.length?n[0]:null}},{key:"_getAvailableItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var n=this._filterItems(this._options.items,e,t);return n.length?n[0]:null}},{key:"_filterItems",value:function(e,t,n){var s=this._options.filterMatchCase;return e.filter((function(e){return"string"==typeof e[n]&&"string"==typeof t?s?e[n]===t:e[n].toLowerCase()==t.toLowerCase():e[n]==t}))}},{key:"_removeItem",value:function(e){var t=this;return this._vars.setItems.every((function(n,s){return n[t.key]!==e||(t.emit("removeToken",t,n),t._vars.setItems.splice(s,1),t.emit("removedToken",t,n),t.emit("change",t),!1)})),this}},{key:"_addItem",value:function(e){e.focused=!1;var t=this._options;if((e.isNew&&!this._getItem(e[t.itemData],t.itemData)||!this._getItem(e[t.itemValue],t.itemValue))&&(this.emit("addToken",this,e),!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)){e.selected=!1;var n=Object.assign({},e);this._vars.setItems.push(n),this.emit("addedToken",this,n),this.emit("change",this)}return this}},{key:"getFocusedItem",value:function(){var e=this._vars.setItems.filter((function(e){return e.focused}))[0];return e.length?e[0]:null}},{key:"getFocusedItems",value:function(){return this._vars.setItems.filter((function(e){return e.focused}))}},{key:"_focusItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this;if(t){var r=this,o=null,u=null,l=null,a=this._vars.setItems.length;if(this._vars.setItems.forEach((function(t,n){t[r.key]===e&&(l=n),null===o&&t.focused&&(o=n),t.focused&&(u=n)})),(0===l||l===a-1)&&null===o&&null===u)return;null===o&&null===u?this._vars.setItems[l].focused=!0:0!==l||u!==a-1||s?(o=Math.min(l,o),u=Math.max(l,u),this._vars.setItems.forEach((function(e,t){e.focused=l===t||t>=o&&t<=u}))):this._vars.setItems[o].focused=!1}else this._vars.setItems.forEach((function(t){t.focused=n?t[i.key]===e?!t.focused:t.focused:t[i.key]===e}));return this}},{key:"_defocusItem",value:function(e){var t=this;return this._vars.setItems.filter((function(n){n[t.key]===e&&(n.focused=!1)}))}},{key:"_defocusItems",value:function(){return this._vars.setItems.forEach((function(e){e.focused=!1})),this}},{key:"_newItem",value:function(e){var t=this._options;if("string"==typeof e&&(!e.length||e.length<t.minLength))return null;var n=this._getItem(e,t.itemData)||this._getSuggestedItem(e,t.itemData)||this._getAvailableItem(e,t.itemData);if(!n&&t.newItems){if("function"==typeof t.validateNewItem&&!t.validateNewItem(e))return null;var s;c(s={isNew:!0},this.key,Q()),c(s,t.itemData,e),n=s,this.emit("newToken",this,n)}return n?(this._addItem(n),n):null}},{key:"_buildEl",value:function(e){return ee(e)}},{key:"_getBounds",value:function(){return this._html.container.getBoundingClientRect()}},{key:"_renderItems",value:function(){var e=this,t=this._vars,n=this._options,s=this._html;return s.items.innerHTML="",t.setItems.forEach((function(t,n){var i=e._renderItem(t,n);s.items.appendChild(i),t.el=i,t.focused?t.el.classList.add("focused"):t.el.classList.remove("focused")})),t.setItems.length>1&&"tokenfield"===n.mode?s.input.setAttribute("placeholder",""):"list"===n.mode&&s.input.setAttribute("placeholder",n.placeholder),this._input&&(this._input.value=t.setItems.map((function(e){return e[n.singleInputValue]})).join(n.singleInputDelimiter)),this}},{key:"_refreshItems",value:function(){this._vars.setItems.forEach((function(e){e.el&&(e.focused?e.el.classList.add("focused"):e.el.classList.remove("focused"))}))}},{key:"_renderItem",value:function(e,t){var n=this._options,s=this.renderSetItemHtml(e),i=s.querySelector(".item-label"),r=s.querySelector(".item-input"),o=s.querySelector(".item-remove"),u=n.keepItemsOrder?"[".concat(t,"]"):"[]";return s.key=e[this.key],o.key=e[this.key],r.setAttribute("name",(e.isNew?n.newItemName:n.itemName)+u),r.value=e[e.isNew?n.newItemValue:n.itemValue]||null,i.textContent=this.renderSetItemLabel(e),e.focused&&s.classList.add("focused"),s}},{key:"onInput",value:function(e,t){return e}},{key:"renderSetItemHtml",value:function(){return this._buildEl(this._templates.setItem)}},{key:"renderSetItemLabel",value:function(e){return e[this._options.itemLabel]}},{key:"renderSuggestions",value:function(e){var t=this,n=this._vars,s=this._options,i=this._html,r=this._getSelectedItemIndex();if(!e.length)return this;if(0===s.maxSuggestWindow&&(i.suggest.style.maxHeight=null),!n.suggestedItems.length)return this;s.newItems||null!==r||(e[0].selected=!0);var o=0;e.every((function(e,n){if(n>=s.maxSuggest)return!1;var r=i.suggestList.childNodes[n],u=e.el=t.renderSuggestedItem(e);return r?r.itemValue===e[s.itemValue]?(r.key=e[t.key],e.el=r):i.suggestList.replaceChild(u,r):r||i.suggestList.appendChild(u),s.maxSuggestWindow>0&&n<s.maxSuggestWindow&&(o+=i.suggestList.childNodes[n].getBoundingClientRect().height),s.maxSuggestWindow>0&&n===s.maxSuggestWindow&&(i.suggest.style.maxHeight=o+"px"),!0}));var u=i.suggestList.childElementCount-e.length;if(u>0)for(var l=u-1;l>=0;l--)i.suggestList.removeChild(i.suggestList.childNodes[e.length+l]);return this}},{key:"renderSuggestedItem",value:function(e){var t=this._options,n=this._buildEl(this._templates.suggestItem);(n.key=e[this.key],n.itemValue=e[t.itemValue],n.innerHTML=this.renderSuggestedItemContent(e),n.setAttribute("title",e[t.itemData]),e.selected&&n.classList.add("selected"),t.filterSetItems)||(this._getItem(e[t.itemValue],t.itemValue)||this._getItem(e[t.itemData],t.itemData))&&n.classList.add("set");return n}},{key:"renderSuggestedItemContent",value:function(e){return e[this._options.itemData]}},{key:"_refreshSuggestions",value:function(){var e=this._vars,t=this._options;if(this._html.input.value.length<t.minChars)return this.hideSuggestions(),this;var n=this._prepareData(t.items),s=this._filterData(this._html.input.value,n);return e.suggestedItems=t.filterSetItems?this._filterSetItems(s):s,e.suggestedItems.length&&(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)?(this.renderSuggestions(e.suggestedItems),this):(this.hideSuggestions(),this)}},{key:"showSuggestions",value:function(){var e=this._vars,t=this._options;return e.suggestedItems.length?(this.emit("showSuggestions",this),(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)&&(this._html.suggest.style.display="block",e.suggested=!0,this.renderSuggestions(e.suggestedItems)),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}},{key:"hideSuggestions",value:function(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}},{key:"setSuggestedItems",value:function(e){if(!Array.isArray(e))throw new Error("Argument must be an array of objects.");this._options.items=e,this._refreshSuggestions()}},{key:"getItems",value:function(){var e=this;return this._vars.setItems.map((function(t){var n=Object.assign({},t);return delete n[e.key],delete n.focused,delete n.selected,delete n.el,n}))}},{key:"setItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this._vars.setItems=[],this.addItems(e),this}},{key:"addItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=this._options.itemValue;return Array.isArray(e)||(e=[e]),this._prepareData(e).forEach((function(e){(e.isNew||void 0!==e[n])&&t._addItem(e)})),this._minimizeInput()._renderItems()._refreshInput().hideSuggestions(),this}},{key:"sortItems",value:function(){var e=this,t=[];p(this._html.items.childNodes).forEach((function(n){var s=e._getItem(n.key);s&&t.push(s)})),this.setItems(t)}},{key:"removeItem",value:function(e){var t=this._options;"object"==typeof e&&(e[t.itemValue]||e[t.newItemValue])&&(e=e[t.itemValue]||e[t.newItemValue]);var n=this._getItem(e,t.itemValue)||this._getItem(e,t.newItemValue);return n?(this._removeItem(n[this.key])._renderItems(),this):this}},{key:"emptyItems",value:function(){return this._vars.setItems=[],this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"getSuggestedItems",value:function(){return this._vars.suggestedItems.map((function(e){return Object.assign({},e)}))}},{key:"focus",value:function(){return this._html.container.classList.add("focused"),this._focused||this._html.input.focus(),this}},{key:"blur",value:function(){return this._html.container.classList.remove("focused"),this._focused&&this._html.input.blur(),this}},{key:"remove",value:function(){var e=this._html;e.container.parentElement.insertBefore(this.el,e.container),e.container.remove(),this.el.style.display="block",1===Object.keys(W).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),this._form&&this._form.nodeName&&this._form.removeEventListener("reset",this._vars.events.onReset),delete W[this.id],delete this.el.tokenfield}}]),r}(e(D)),ie=function(e){"use strict";d(i,e);var s=a(i);function i(){var e;return n(this,i),c(t(e=s.apply(this,arguments)),"_renderItem",(function(e,t){var n=this._options,s=this.renderSetItemHtml(e),i=s.querySelector(".item-label"),r=s.querySelector(".item-input"),o=s.querySelector(".item-remove");return s.key=e[this.key],o.key=e[this.key],r.setAttribute("name",e.isNew?n.newItemName:n.itemName),r.value=e[e.isNew?n.newItemValue:n.itemValue]||null,i.textContent=this.renderSetItemLabel(e),e.focused&&s.classList.add("focused"),s})),e}return i}(se),re=window.TokenField=ie,oe=function(e){return{id:e.value,name:e.value,classes:[]}};!function(){var e=document.querySelector("#div_id_goods");if(e){var t=function(e){var t=document.createElement("div");return t.classList.add("tau__first-column--options"),e.insertBefore(t,e.firstElementChild.nextElementSibling),t}(e),n=function(e){var t=document.createElement("button");t.innerText=_,t.classList.add("lite-button--link","tau__select-all");var n=e.querySelectorAll("[name=goods]");return new I(t,n).init(),t}(e),s=function(e){var t=document.createElement("button");t.innerText=k,t.classList.add("lite-button--link");var n=e.querySelectorAll(".govuk-details");return new S(t,n).init(),t}(e);t.append(n,s)}}(),function(){var e=document.querySelector("#div_id_goods");if(e){var t=e.querySelectorAll("[name=goods]"),n=document.querySelector(".tau__second-column");new b(t,n,"tau__second-column--hide").init()}}(),function(){var e=document.querySelector(".tau__headline"),t=new x(e),n=document.querySelector("[name=does_not_have_control_list_entries]"),s=new A("#control_list_entries",n);s.init();var i=new O("#control_list_entries"),r=document.createElement("div");r.classList.add("tau__cle-suggestions");var o=document.querySelector("[for=control_list_entries]");o.parentNode.insertBefore(r,o.nextSibling);var u=new C(r,(function(e){i.setSuggestions(e),s.reset()})),l=document.querySelector("#div_id_goods").querySelectorAll("[name=goods]"),a=JSON.parse(document.querySelector("#cle-suggestions-json").textContent);new L(l,a,(function(e){t.setProducts(e),u.setProducts(e)})).init(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:oe;e.parentElement.classList.add("tokenfield-container");for(var n=[],s=[],i=0;i<e.options.length;i++){var r=e.options.item(i),o=t(r);r.selected&&s.push(o),n.push(o)}var u=new re({el:e,items:n,newItems:!1,addItemOnBlur:!0,filterSetItems:!1,addItemsOnPaste:!0,minChars:1,itemName:e.name,setItems:s,keepItemsOrder:!1});u._renderItems(),u._html.container.id=e.id,e.remove()}(document.querySelector("#mtcr_entries"),(function(e){return{id:e.value,name:e.label,classes:[]}}))}(),ne=document.querySelector("#submit-id-submit"),new w(ne).init()}();
//# sourceMappingURL=tau.js.map
